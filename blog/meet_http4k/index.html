
<!DOCTYPE html>
<html lang="en" class="no-js" itemscope itemtype="http://schema.org/Product">
<head>
    
    <meta charset="utf-8">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <meta itemprop="name" content="http4k - a functional Kotlin HTTP toolkit">
    <meta name="twitter:title" content="http4k - a functional Kotlin HTTP toolkit">
    <meta property="og:title" content="http4k - a functional Kotlin HTTP toolkit" />
    
    
    <meta name="description" content="http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way.">
    <meta property="og:description" content="http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way." />
    <meta name="twitter:description" content="http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way.">
    
    
    <link rel="canonical" href="https://http4k.org/blog/meet_http4k/">
    
    
    <meta name="author" content="David Denton (@daviddenton), IvanSanchez (@s4nchez)">
    <meta name="twitter:creator" content="David Denton (@daviddenton), IvanSanchez (@s4nchez)">
    
    <!-- ****** faviconit.com favicons ****** -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="icon" sizes="16x16 32x32 64x64" href="/img/favicon.ico">
    <link rel="icon" type="image/png" sizes="196x196" href="/img/favicon-192.png">
    <link rel="icon" type="image/png" sizes="160x160" href="/img/favicon-160.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/img/favicon-64.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
    <link rel="apple-touch-icon" href="/img/favicon-57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/favicon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/favicon-72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/favicon-144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/favicon-60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/favicon-120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/favicon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-180.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="/img/favicon-144.png">
    <meta name="msapplication-config" content="/img/browserconfig.xml">
    <!-- ****** faviconit.com favicons ****** -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@http4k">
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://www.http4k.org/" />
    <meta name="twitter:image" content="https://www.http4k.org/img/logo_card_blue_on_white.png">
    <meta property="og:image" content="https://www.http4k.org/img/logo_card_blue_on_white.png" />
    <meta itemprop="image" content="https://www.http4k.org/img/logo_card_blue_on_white.png">

    <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.3">
    
    
    
    <title>Meet http4k - http4k</title>
    
    
    
    <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
    <link rel="stylesheet" href="../../assets/stylesheets/application-acc56dad49.css">
    
    <link rel="stylesheet" href="../../assets/stylesheets/application-8817cfa535.palette.css">
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
    <style>body, input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
    }

    code, kbd, pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
    }</style>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    <link rel="stylesheet" href="../.././css/site.css">
    
    
    <script type="application/ld+json">
        {
          "@context" : "http://schema.org",
          "@type" : "WebSite",
    
          "name" : "http4k - a functional Kotlin HTTP toolkit",
    
    
          "alternateName" : "http4k is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way.",
    
          "image": "https://www.http4k.org/img/logo_card_blue_on_white.png",
          "url" : "https://http4k.org/blog/meet_http4k/"
        }
        </script>
</head>




<body data-md-color-primary="indigo" data-md-color-accent="blue">

<svg class="md-svg">
    <defs>
        
        
        <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
    </defs>
</svg>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>

<header class="md-header" data-md-component="header">
    <nav class="md-header-nav md-grid">
        <div class="md-flex">
            <div class="md-flex__cell md-flex__cell--shrink">
                
                <a href="https://http4k.org" title="http4k" class="md-logo md-header-nav__button">
                    <img src="../../img/logo_1100x200_white_on_blue_trans.png" height="24">
                </a>
                
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Blog
                </span>
              
            
            Meet http4k
          
        </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                
                <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
                
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
                
            </div>
            
            <div class="md-flex__cell md-flex__cell--shrink">
                <div class="md-header-nav__source">
                    


  


  <a href="https://github.com/http4k/http4k/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

                </div>
            </div>
            
        </div>
    </nav>
</header>

<div class="md-container">
    
    
    <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
            
            
            <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                        <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="drawer">
        
        <i class="md-logo md-nav__button">
            <img src="../../img/logo_1100x200_white_on_blue_trans.png">
        </i>
        
        http4k
    </label>
    
    <div class="md-nav__source">
        


  


  <a href="https://github.com/http4k/http4k/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../rationale/" title="Rationale & Concepts" class="md-nav__link">
      Rationale & Concepts
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../quickstart/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/aws/" title="AWS" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/core/" title="Core" class="md-nav__link">
      Core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/hamkrest/" title="Hamkrest" class="md-nav__link">
      Hamkrest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/clients/" title="HTTP client" class="md-nav__link">
      HTTP client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/message_formats/" title="Message formats" class="md-nav__link">
      Message formats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/multipart/" title="Multipart forms" class="md-nav__link">
      Multipart forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/resilience/" title="Resilience" class="md-nav__link">
      Resilience
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/servers/" title="Server backend" class="md-nav__link">
      Server backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/serverless/" title="Serverless backend" class="md-nav__link">
      Serverless backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/templating/" title="Templating" class="md-nav__link">
      Templating
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/contracts/" title="Typesafe contracts" class="md-nav__link">
      Typesafe contracts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/modules/webdriver/" title="WebDriver" class="md-nav__link">
      WebDriver
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/testing/" title="Application Testing" class="md-nav__link">
      Application Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Worked TDD Example
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Worked TDD Example
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/example/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/example/_1_building_a_walking_skeleton/" title="1. Building a walking skeleton" class="md-nav__link">
      1. Building a walking skeleton
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/example/_2_adding_the_first_endpoint/" title="2. Adding an endpoint" class="md-nav__link">
      2. Adding an endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/example/_3_adding_the_second_endpoint/" title="3. Adding another endpoint" class="md-nav__link">
      3. Adding another endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/example/_4_adding_an_external_dependency/" title="4. An external dependency" class="md-nav__link">
      4. An external dependency
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Cookbook
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Cookbook
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/server_as_a_function/" title="Server as a function" class="md-nav__link">
      Server as a function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/client_as_a_function/" title="Client as a function" class="md-nav__link">
      Client as a function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/container_integration/" title="Container integration" class="md-nav__link">
      Container integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/simple_routing/" title="Simple routing" class="md-nav__link">
      Simple routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/nestable_routes/" title="Nestable routes" class="md-nav__link">
      Nestable routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/using_json/" title="JSON messaging" class="md-nav__link">
      JSON messaging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/using_templates/" title="Templating engines" class="md-nav__link">
      Templating engines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/request_context/" title="Typesafe RequestContexts" class="md-nav__link">
      Typesafe RequestContexts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/typesafe_http_requests_with_lenses/" title="Typesafe HTTP requests with lenses" class="md-nav__link">
      Typesafe HTTP requests with lenses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/html_forms/" title="HTML forms" class="md-nav__link">
      HTML forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/multipart_forms/" title="Multipart forms" class="md-nav__link">
      Multipart forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/generating_data_classes/" title="Generating data classes for messages" class="md-nav__link">
      Generating data classes for messages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/websockets/" title="Websockets" class="md-nav__link">
      Websockets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/typesafe_http_contracts/" title="Typesafe HTTP contracts" class="md-nav__link">
      Typesafe HTTP contracts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/record_and_replay/" title="Recording/replaying HTTP traffic" class="md-nav__link">
      Recording/replaying HTTP traffic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook/test_driven_apps/" title="Test driven apps" class="md-nav__link">
      Test driven apps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../in_action/" title="In action" class="md-nav__link">
      In action
    </a>
  </li>

        
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      Blog
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Blog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Meet http4k
      </label>
    
    <a href="./" title="Meet http4k" class="md-nav__link md-nav__link--active">
      Meet http4k
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#daviddenton-november-2017" title="@daviddenton / november 2017" class="md-nav__link">
    @daviddenton / november 2017
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meet-http4k" title="Meet http4k" class="md-nav__link">
    Meet http4k
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oh-god-not-another-framework-why-does-this-even-exist" title="Oh god, not another framework! Why does this even exist?!?" class="md-nav__link">
    Oh god, not another framework! Why does this even exist?!?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#claim-a-small-simple-immutable" title="Claim A: Small, simple, immutable." class="md-nav__link">
    Claim A: Small, simple, immutable.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-1-httphandler" title="Function 1: HttpHandler" class="md-nav__link">
    Function 1: HttpHandler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-2-filter" title="Function 2: Filter" class="md-nav__link">
    Function 2: Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing" title="Routing" class="md-nav__link">
    Routing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#claim-b-symmetric-http" title="Claim B. Symmetric HTTP" class="md-nav__link">
    Claim B. Symmetric HTTP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#claim-c-typesafe-http-with-lenses" title="Claim C. Typesafe HTTP with Lenses" class="md-nav__link">
    Claim C. Typesafe HTTP with Lenses
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lens-basics" title="Lens basics" class="md-nav__link">
    Lens basics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lensing-http-bodies-with-data-classes" title="Lensing HTTP bodies with Data classes" class="md-nav__link">
    Lensing HTTP bodies with Data classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#claim-d-serverless" title="Claim D. Serverless" class="md-nav__link">
    Claim D. Serverless
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-final-words" title="The final word(s)!" class="md-nav__link">
    The final word(s)!
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#footnotes" title="Footnotes" class="md-nav__link">
    Footnotes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../contributing/" title="Contribute/Support http4k" class="md-nav__link">
      Contribute/Support http4k
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
        
        
        


  <li class="md-nav__item">
    <a href="../../support/" title="Help & Support" class="md-nav__link">
      Help & Support
    </a>
  </li>

        
    </ul>
</nav>
                    </div>
                </div>
            </div>
            
            
            <div class="md-content">
                <article class="md-content__inner md-typeset">
                    
                    
                    <a href="https://github.com/http4k/http4k/edit/master/src/docs/blog/meet_http4k/index.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                    
                    
                    <h1 id="server-as-a-function-in-kotlin-typesafe-without-the-server">Server as a Function. In Kotlin. Typesafe. Without the Server.</h1>
<h5 id="daviddenton-november-2017"><a href="http://github.com/daviddenton">@daviddenton</a> / november 2017</h5>
<h2 id="meet-http4k">Meet <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a></h2>
<p><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is an HTTP toolkit written in Kotlin that enables the serving and consuming of HTTP services in a functional and consistent way.</p>
<p>Whenever (yet another) new JVM HTTP framework is released, the inevitable question that rightly get asked is <strong>"How it this different to X?"</strong>. In this post, I'm going to briefly cover what <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is, how we think it's different, and address some of those <strong>bold claims</strong> from the title of this post.</p>
<p>Here's a quick rundown of what we think those differences are:</p>
<ul>
<li><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is small. Written in pure, functional Kotlin, with zero dependencies.</li>
<li><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is simple. Like, really simple. No static API magic, no annotations, no reflection.</li>
<li><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is immutable. It relies on an immutable HTTP model, which makes it a snap to test and debug.</li>
<li><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is symmetric. It supports remote calls as a first-class concern, and the remote HTTP model is identical to the incoming HTTP model.</li>
<li><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is typesafe. Say goodbye to all your validation and marshalling boilerplate and hello to automatic request validation and data class-based contracts for HTTP bodies using the Lens API.</li>
<li><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is serverless. Or rather - server independent. Test an app out of container and then deploy it into any supported local container with 1 LOC - or as a function into AWS Lambda.</li>
</ul>
<h3 id="oh-god-not-another-framework-why-does-this-even-exist">Oh god, not another framework! Why does this even exist?!?</h3>
<p>Firstly - we don't consider <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> to be a framework - it's a set of libraries providing a functional toolkit to serve and consume HTTP services, focusing on simple, consistent, and testable APIs. Hence, whilst it does provide support for various APIs <em>relevant to serving and consuming HTTP</em>, it does not provide every integration under the sun - merely simple points to allow those integrations to be hooked in.</p>
<p>Another thing to say is that (not very much) of <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is new - it's rather the distillation of 15 years worth of experience of using various server-side libraries and hence most of the good ideas are stolen. For instance - the routing module is inspired by <a href="https://github.com/bodar/utterlyidle">UtterlyIdle</a>, the basic "Server as a function" model is stolen from <a href="https://twitter.github.io/finagle/">Finagle</a>, and the contract module OpenApi/Swagger generator is ported from <a href="http://fintrospect.io/">Fintrospect</a>. </p>
<p>With the growing adoption of Kotlin, we wanted something that would fully leverage the functional features of the language and it felt like a good time to start something from scratch, whilst avoiding the <em>magic</em> that plagues other frameworks. Hence, <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is primarily designed to be a Kotlin-first library.</p>
<h2 id="claim-a-small-simple-immutable">Claim A: Small, simple, immutable.</h2>
<p>Based on the awesome <a href="https://monkey.org/~marius/funsrv.pdf">"Your Server as a Function"</a> paper from Twitter, <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> apps are modelled by composing 2 types of simple, independent function. </p>
<h3 id="function-1-httphandler">Function 1: HttpHandler</h3>
<p>An <code>HttpHandler</code> represents an HTTP endpoint. It's not even an Interface, modelled merely as a <a href="https://kotlinlang.org/docs/reference/type-aliases.html">Typealias</a>:</p>
<div class="codehilite"><pre><span></span><span class="n">typealias</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">(</span><span class="n">Request</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Response</span>
</pre></div>


<p>Below is a entire <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> application that echoes the request body back in the response. It only relies on the <code>http4k-core</code> module, which itself has zero dependencies:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">app</span> <span class="p">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">)</span> <span class="p">}</span>
<span class="k">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">asServer</span><span class="p">(</span><span class="n">SunHttp</span><span class="p">(</span><span class="m">8000</span><span class="p">)).</span><span class="n">start</span><span class="p">()</span>
</pre></div>


<p>The <code>Request</code> and <code>Response</code> objects in there are immutable data classes/POKOs, so testing the app requires absolutely no extra infrastructure - just call the function, it's as easy as:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AppTest</span> <span class="p">{</span>
    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="err">`</span><span class="nf">echoes</span> <span class="n">request</span> <span class="n">body</span><span class="err">`</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">app</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">POST</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)),</span> <span class="n">equalTo</span><span class="p">(</span><span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>To plug it into a different Server-backend, just depend on the relevant module (Jetty, Undertow, Netty are available) and change the call to <code>asServer()</code>.</p>
<h3 id="function-2-filter">Function 2: Filter</h3>
<p><code>Filters</code> provides pre and post Request processing and are simply:</p>
<div class="codehilite"><pre><span></span><span class="k">interface</span> <span class="nc">Filter</span> <span class="p">:</span> <span class="p">(</span><span class="n">HttpHandler</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">HttpHandler</span>
</pre></div>


<p>For API conciseness and discoverability reasons this is modelled as an Interface and not a <a href="https://kotlinlang.org/docs/reference/type-aliases.html">Typealias</a> - it also has a couple of Kotlin <a href="https://kotlinlang.org/docs/reference/extensions.html">extension methods</a> to allow you to compose <code>Filters</code> with <code>HttpHandlers</code> and other <code>Filters</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">setContentType</span> <span class="p">=</span> <span class="n">Filter</span> <span class="p">{</span> <span class="n">next</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">request</span> <span class="p">-&gt;</span> <span class="n">next</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s">&quot;text/plain&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="k">val</span> <span class="py">repeatBody</span> <span class="p">=</span> <span class="n">Filter</span> <span class="p">{</span> <span class="n">next</span> <span class="p">-&gt;</span>
        <span class="p">{</span> <span class="n">request</span> <span class="p">-&gt;</span> <span class="n">next</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">bodyString</span><span class="p">()</span> <span class="p">+</span> <span class="n">request</span><span class="p">.</span><span class="n">bodyString</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="k">val</span> <span class="py">composedFilter</span><span class="p">:</span> <span class="n">Filter</span> <span class="p">=</span> <span class="n">repeatBody</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">setContentType</span><span class="p">)</span>
<span class="k">val</span> <span class="py">decoratedApp</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">composedFilter</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>


<p>Filters are also trivial to test independently, because they are generally just stateless functions.</p>
<h3 id="routing">Routing</h3>
<p><a href="https://github.com/http4k/http4k">http4k</a>'s nestable routing looks a lot like every other Sinatra-style framework these days, and allows for infinitely nesting <code>HttpHandlers</code> - this just exposes another <code>HttpHandler</code> so you can easily extract, test and reuse sets of routes as easily as you could with one:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">app</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">routes</span><span class="p">(</span>
    <span class="s">&quot;/app&quot;</span> <span class="n">bind</span> <span class="n">GET</span> <span class="n">to</span> <span class="n">decoratedApp</span><span class="p">,</span>
    <span class="s">&quot;/other&quot;</span> <span class="n">bind</span> <span class="n">routes</span><span class="p">(</span>
        <span class="s">&quot;/delete&quot;</span> <span class="n">bind</span> <span class="n">DELETE</span> <span class="n">to</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span> <span class="p">},</span>
        <span class="s">&quot;/post/{name}&quot;</span> <span class="n">bind</span> <span class="n">POST</span> <span class="n">to</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="s">&quot;you POSTed to ${request.path(&quot;</span><span class="n">name</span><span class="s">&quot;)}&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>


<p>And that it - those functions are everything you need to know to write a simple <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> application. The <code>http4k-core</code> module rocks in at &lt;1000 lines of code (about 600kb), and has zero dependencies (other than the Kotlin language itself). Additionally, everything in the core is <em>functional and predictable</em> - there is no static API magic going on under the covers (making it difficult to have multiple apps in the same JVM), no annotations, no compiler-plugins, and no reflection.</p>
<h2 id="claim-b-symmetric-http">Claim B. Symmetric HTTP</h2>
<p>Out of the multitude of JVM http frameworks out there, not many actually consider how you app talks to other services, yet in this Microserviceâ„¢ world that's an absolutely massive part of what many apps do!</p>
<p>As per a core principle behind "Server as a Function", <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> provides a symmetric API for HTTP clients - ie. it's <em>exactly</em> the same API as is exposed in <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> server applications - the <code>HttpHandler</code>. Here's that entire API again, just in case you've forgotten:</p>
<div class="codehilite"><pre><span></span><span class="n">typealias</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">(</span><span class="n">Request</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Response</span>
</pre></div>


<p>What does that mean in practice? Well - for one thing, it's less for your brain to learn  because you already know the API:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">client</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">ApacheClient</span><span class="p">()</span>
<span class="k">val</span> <span class="py">response</span><span class="p">:</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">client</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://server/path&quot;</span><span class="p">))</span>
</pre></div>


<p>For another, it means that since clients are <em>just function</em>s you can easily stub them for testing, and since applications and clients are interchangeable, they can be plugged together in memory without putting them on the network - which makes testing insanely fast:</p>
<div class="codehilite"><pre><span></span><span class="k">fun</span> <span class="nf">MyApp1</span><span class="p">():</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">)</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nf">MyApp2</span><span class="p">(</span><span class="n">app1</span><span class="p">:</span> <span class="n">HttpHandler</span><span class="p">):</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">app1</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>

<span class="k">val</span> <span class="py">app1</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">MyApp1</span><span class="p">()</span>
<span class="k">val</span> <span class="py">app2</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">MyApp2</span><span class="p">(</span><span class="n">app1</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> provides a HTTP client adapters for both <a href="https://hc.apache.org/">Apache</a> and <a href="http://square.github.io/okhttp/">OkHttp</a>, all with streaming support.</p>
<h2 id="claim-c-typesafe-http-with-lenses">Claim C. Typesafe HTTP with Lenses</h2>
<p>The immutable <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> model for HTTP objects contains all the usual suspect methods for getting values from the messages. For instance, if we are expecting a search parameter with a query containing a page number:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">request</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://server/search?page=123&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">page</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">)</span><span class="o">!!</span><span class="p">.</span><span class="n">toInt</span>
</pre></div>


<p>...but we also want to ensure that the expected values are both present and valid, since the above example will fail if either of those things is not true. For this purpose, we can use a <a href="https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/basic-lensing">Lens</a> to enforce the expected HTTP contract.</p>
<p>The use of Lenses in <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> applications can remove the need for writing any parsing or validation code for all incoming data (including Forms), as validations are taken care of by the library. </p>
<h3 id="lens-basics">Lens basics</h3>
<p>A Lens is a bi-directional entity which can be used to either <em>get</em> or <em>set</em> a particular value from/onto an HTTP message. <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> provides a DSL to configure these lenses to target particular parts of the message, whilst at the same time specifying the requirement for those parts (i.e. mandatory or optional) and the type. For the above example, we could use the <code>Query</code> Lens builder and then <code>invoke()</code> the Lens on the message to extract the target value:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">pageLens</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">int</span><span class="p">().</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">page</span><span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="n">pageLens</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://server/search?page=123&quot;</span><span class="p">))</span>
</pre></div>


<p>If the query parameter is missing or not an Int, the lens extraction operation will fail. There are similar Lens builder functions for all parts of the HTTP message (<code>Header</code>, <code>Path</code>, <code>Body</code>, <code>FormField</code> etc..), and functions for all common JVM primitive types. They are all completely typesafe - there is no reflection or magic going on - just marshalling of the various entities (in this case String to Int conversion).</p>
<p>In the case of failure, we need to apply a Filter to detect the errors and convert them to a BAD_REQUEST response:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">queryName</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">app</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="n">routes</span><span class="p">(</span>
      <span class="s">&quot;/post&quot;</span> <span class="n">bind</span> <span class="n">POST</span> <span class="n">to</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="p">-&gt;</span> <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">queryName</span><span class="p">(</span><span class="n">request</span><span class="p">))</span> <span class="p">}</span>
    <span class="p">)</span>

<span class="k">val</span> <span class="py">app</span> <span class="p">=</span> <span class="n">ServerFilters</span><span class="p">.</span><span class="n">CatchLensFailure</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">handler</span><span class="p">)(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/hello/2000-01-01?myCustomType=someValue&quot;</span><span class="p">))</span>
</pre></div>


<p>Lenses can also be applied with a correctly typed value (via <code>invoke()</code>) to set it <em>onto</em> a target object - and as HTTP messages in <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> are immutable, this results in a copy of the modified message:</p>
<div class="codehilite"><pre><span></span><span class="k">val</span> <span class="py">pageSizeLens</span> <span class="p">=</span> <span class="n">Header</span><span class="p">.</span><span class="n">int</span><span class="p">().</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">page</span><span class="p">:</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">pageLens</span><span class="p">(</span><span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">),</span> <span class="m">123</span><span class="p">)</span>
<span class="c1">// or apply multiple lenses using with()</span>
<span class="k">val</span> <span class="py">updated</span><span class="p">:</span> <span class="n">Request</span> <span class="p">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/foo&quot;</span><span class="p">).</span><span class="n">with</span><span class="p">(</span><span class="n">pageLens</span> <span class="n">of</span> <span class="m">123</span><span class="p">,</span> <span class="n">pageSizeLens</span> <span class="n">of</span> <span class="m">10</span><span class="p">)</span>
</pre></div>


<p>Securely extracting JDK primitives from HTTP messages is great, but we really want to avoid primitives entirely and go straight to domain types. During construction of Lens, the builders allow mapping to occur so we can leverage Kotlin data classes. This works for both get and set operations:</p>
<div class="codehilite"><pre><span></span><span class="k">data</span> <span class="k">class</span> <span class="nc">MyDate</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">LocalDate</span><span class="p">)</span>
<span class="k">val</span> <span class="py">dateQuery</span> <span class="p">=</span> <span class="n">Query</span><span class="p">.</span><span class="n">localDate</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">::</span><span class="n">MyDate</span><span class="p">,</span> <span class="n">MyDate</span><span class="o">::</span><span class="n">value</span><span class="p">).</span><span class="n">required</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">myDate</span><span class="p">:</span> <span class="n">MyDate</span> <span class="p">=</span> <span class="n">dateQuery</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;http://server/search?date=2000-01-01&quot;</span><span class="p">))</span>
</pre></div>


<h3 id="lensing-http-bodies-with-data-classes">Lensing HTTP bodies with Data classes</h3>
<p>Some of the supported message libraries (eg. GSON, Jackson, XML) provide the mechanism to automatically marshall data objects to/from JSON and XML using reflection (oops - looks like we broke our reflection promise - but technically we're not doing it ;) !). This behaviour is supported in <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> Lenses through the use of the <code>auto()</code> method, which will marshall objects to/from HTTP messages:</p>
<div class="codehilite"><pre><span></span><span class="k">data</span> <span class="k">class</span> <span class="nc">Email</span><span class="p">(</span><span class="k">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="k">val</span> <span class="py">subject</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="k">val</span> <span class="py">from</span><span class="p">:</span> <span class="n">Email</span><span class="p">,</span> <span class="k">val</span> <span class="py">to</span><span class="p">:</span> <span class="n">Email</span><span class="p">)</span>

<span class="k">val</span> <span class="py">messageLens</span> <span class="p">=</span> <span class="n">Body</span><span class="p">.</span><span class="n">auto</span><span class="p">&lt;</span><span class="n">Message</span><span class="p">&gt;().</span><span class="n">toLens</span><span class="p">()</span>
<span class="k">val</span> <span class="py">body</span> <span class="p">=</span> <span class="s">&quot;&quot;&quot;{&quot;</span><span class="n">subject</span><span class="s">&quot;:&quot;</span><span class="n">hello</span><span class="s">&quot;,&quot;</span><span class="n">from</span><span class="s">&quot;:{&quot;</span><span class="n">value</span><span class="s">&quot;:&quot;</span><span class="n">bob@git</span><span class="p">.</span><span class="n">com</span><span class="s">&quot;},&quot;</span><span class="n">to</span><span class="s">&quot;:{&quot;</span><span class="n">value</span><span class="s">&quot;:&quot;</span><span class="n">sue@git</span><span class="p">.</span><span class="n">com</span><span class="s">&quot;}}&quot;&quot;&quot;</span>
<span class="k">val</span> <span class="py">message</span><span class="p">:</span> <span class="n">Message</span> <span class="p">=</span> <span class="n">messageLens</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
</pre></div>


<p>This mechanism works for all incoming and outgoing JSON and XML Requests and Responses. To assist with developing whilst using this type of auto-marshalling, we have created a <a href="http://http4k-data-class-gen.herokuapp.com/">tool</a> to automatically generate a set of data classes for a given messages.</p>
<h2 id="claim-d-serverless">Claim D. Serverless</h2>
<p>Ah yes - Serverless - the latest in the Cool Kids Club and killer fodder for the resume. Well, since <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is server independent, it turns out to be fairly trivial to deploy full applications to <a href="https://aws.amazon.com/lambda">AWS Lambda</a>, and then call them by setting up the <a href="https://aws.amazon.com/api-gateway">API Gateway</a> to proxy requests to the function. Effectively, the combination of these two services become just another Server back-end supported by the library.</p>
<p>In order to achieve this, only a single interface <code>AppLoader</code> needs to be implemented - this is responsible for creating the <code>HttpHandler</code> which is adapted to the API of the <code>ApiGatewayProxyRequest/ApiGatewayProxyResponse</code> used by AWS. As this is AWS, there is a fair amount of configuration required to make this possible, but the only <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> specific config is to:</p>
<ol>
<li>Set the function execution to call <code>org.http4k.serverless.lambda.LambdaFunction::handle</code></li>
<li>Set an environment variable for the Lambda <code>HTTP4K_BOOTSTRAP_CLASS</code> to the class of your <code>AppLoader</code> class.</li>
</ol>
<p>Here's a simple example:</p>
<div class="codehilite"><pre><span></span><span class="k">object</span> <span class="nc">TweetEcho</span> <span class="p">:</span> <span class="n">AppLoader</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n">Map</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">&gt;):</span> <span class="n">HttpHandler</span> <span class="p">=</span> <span class="p">{</span>
        <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="n">body</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">bodyString</span><span class="p">().</span><span class="n">take</span><span class="p">(</span><span class="m">140</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Since <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is very dependency-light, full binary uploads of these AWS Lambdas tend to be very small - and by utilising <a href="https://www.guardsquare.com/en/proguard">Proguard</a> we've seen the size of a Lambda UberJar go as small as 150kb.</p>
<p>Introduced in v3.2.1, this support is available in the <code>http4k-serverless-lambda</code> module.</p>
<h2 id="the-final-words">The final word(s)!</h2>
<p>As pointed out above, <code>http4k-core</code> module has zero dependencies. It is also small, even though it also provides:</p>
<ul>
<li>Support for static file-serving with HotReload.</li>
<li>A bunch of useful Filters for stuff like <a href="http://zipkin.io/">Zipkin</a> Request Tracing.</li>
<li>Support for Request Contexts.</li>
<li>Facilities to record and replay HTTP traffic.</li>
</ul>
<p>There are also a bunch of other modules available, all presented with the same concentration on Testability, API simplicity and consistency:</p>
<ul>
<li>ViewModel driven templating engine support (Handlerbars etc) with HotReload.</li>
<li>Popular JSON/XML (Gson, Jackson etc) library support for HTTP bodies.</li>
<li>Typesafe HTML Form and Multipart Forms processing, with support for Streaming uploads to a storage service. Forms can also be configured to collect errors instead of just rejecting outright.</li>
<li>Typesafe contract module, providing live <a href="https://www.openapis.org/">OpenApi/Swagger</a> documentation.</li>
<li><a href="https://aws.amazon.com/">AWS</a> request signing.</li>
<li><a href="http://resilience4j.github.io/resilience4j/">Resilience4j</a> integration, including Circuit Breakers &amp; Rate Limiting.</li>
<li>Testing support via <a href="https://github.com/npryce/hamkrest">Hamkrest</a> matchers and an in-memory <a href="https://github.com/SeleniumHQ/selenium">WebDriver</a> implementation.</li>
</ul>
<p>Finally, <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> is <strong>proven in production</strong>, it has been adopted in at least 2 global investment banks and is serving the vast majority of traffic for a major publishing website (in the top 1000 sites globally according to <a href="https://alexa.com">alexa.com</a> - ie. easily serving 10s of million hits per day on a few nodes) since March 2017. </p>
<p>You can see a few example applications <a href="../../in_action/">here</a>, including a bootstrap project for creating a <a href="https://github.com/http4k/http4k-bootstrap"><strong>Github -&gt; Travis -&gt; Heroku</strong> CD pipeline</a> in a single command.</p>
<p>Well, that's it for this whirlwind tour - we hope you found it worth reading this far! We'd love you to try out <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> and feedback why you love/hate/are indifferent to it :) . And if you want to get involved or chat to the authors, we hang out in the friendly #http4k channel @ <a href="http://slack.kotlinlang.org/">slack.kotlinlang,org</a>.</p>
<h5 id="footnotes">Footnotes</h5>
<ul>
<li><strong>"But... but... but... asynchronous! And Webscale!"</strong>, <em>I heard them froth</em>. Yes, you are correct - "Server as a Function" is based on asynchronous functions and <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> exposes a synchronous API. However, our experience suggests that for the vast majority of apps, this actually makes API integration harder unless you've got async all the way down - and that is assuming that async clients are actually available for all your various remote dependencies. We found that this plainly didn't matter for our use-cases so went for <em>Simple APIâ„¢</em> instead... it's possible however that Kotlin co-routines will allow us to revisit this decision.</li>
<li><strong>What no websockets?</strong> Nope - not yet. Because <a href="https://github.com/http4k/http4k"><strong>http4k</strong></a> has been developed in the context of synchronous HTTP REST-y services, the requirement hasn't actually come up as a use-case yet. And because apps are independent of the actual Server that they are deployed to, would need to be reimplemented on each supported Server backend - which means finding a model that fitted all of them. This <em>is</em>, however, entirely doable... we just need the impetus to actually do it. Feel free to contribute a solution... :)</li>
<li><strong>^^Websockets!!</strong> Simple, testable, and available in v3.2.1!</li>
</ul>
                    
                    
                    
                    
                    
                    
                    
                </article>
            </div>
        </div>
    </main>
    
    
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../in_action/" title="In action" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                In action
              </span>
            </div>
          </a>
        
        
          <a href="../../changelog/" title="Changelog" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Changelog
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - David Denton (@daviddenton), IvanSanchez (@s4nchez)
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
    
</div>

<script src="../../assets/javascripts/application-b30566c560.js"></script>


<script>app.initialize({url: {base: "../.."}})</script>




<script>!function (e, t, a, n, o, c, i) {e.GoogleAnalyticsObject = o, e[o] = e[o] || function () {(e[o].q = e[o].q || []).push(arguments)}, e[o].l = 1 * new Date, c = t.createElement(a), i = t.getElementsByTagName(a)[0], c.async = 1, c.src = n, i.parentNode.insertBefore(c, i)}(window, document, "script", "https://www.google-analytics.com/analytics.js", "ga"), ga("create", "UA-69281315-11", "http4k.org"), ga("set", "anonymizeIp", !0), ga("send", "pageview");
var links = document.getElementsByTagName("a");
Array.prototype.map.call(links, function (e) {
    e.host != document.location.host && e.addEventListener("click", function () {
        var t = e.getAttribute("data-md-action") || "follow";
        ga("send", "event", "outbound", t, e.href)
    })
});
var query = document.forms.search.query;
query.addEventListener("blur", function () {
    if (this.value) {
        var e = document.location.pathname;
        ga("send", "pageview", e + "?q=" + this.value)
    }
})</script>


</body>
</html>
