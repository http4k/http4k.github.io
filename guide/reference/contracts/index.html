



<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    
    <script language="JavaScript">
  ak = "Y2JjZDg5MzE5YTUwYjYzMTYyNzFmNGMzZDc5OWM2NTc="
</script>
    <meta charset="utf-8">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta http-equiv="x-ua-compatible" content="ie=edge">


<meta itemprop="name" content="http4k Contract Module">
<meta name="twitter:title" content="http4k Contract Module">
<meta property="og:title" content="http4k Contract Module" />



<meta name="description" content="Feature overview of the http4k-contract module">
<meta property="og:description" content="Feature overview of the http4k-contract module" />
<meta name="twitter:description" content="Feature overview of the http4k-contract module">



<link rel="canonical" href="https://www.http4k.org/guide/reference/contracts/">



<meta name="author" content="David Denton (@daviddenton), Ivan Sanchez (@s4nchez)">
<meta name="twitter:creator" content="David Denton (@daviddenton), Ivan Sanchez (@s4nchez)">




<meta name="lang:clipboard.copy" content="en">

<meta name="lang:clipboard.copied" content="en">

<meta name="lang:search.language" content="en">

<meta name="lang:search.pipeline.stopwords" content="en">

<meta name="lang:search.pipeline.trimmer" content="en">

<meta name="lang:search.result.none" content="en">

<meta name="lang:search.result.one" content="en">

<meta name="lang:search.result.other" content="en">

<meta name="lang:search.tokenizer" content="en">

<!-- ****** faviconit.com favicons ****** -->
<link rel="shortcut icon" href="/img/favicon.ico">
<link rel="icon" sizes="16x16 32x32 64x64" href="/img/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="/img/favicon-192.png">
<link rel="icon" type="image/png" sizes="160x160" href="/img/favicon-160.png">
<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="/img/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
<link rel="apple-touch-icon" href="/img/favicon-57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon-114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon-72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon-144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon-60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon-120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon-152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-180.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="/img/favicon-144.png">
<meta name="msapplication-config" content="/img/browserconfig.xml">
<!-- ****** faviconit.com favicons ****** -->
<meta name="generator" content="mkdocs-1.1.2, mkdocs-material-3.0.4">
    
    
    
    <title>http4k Contract Module</title>
    
    
    
    
    
    
    <meta name="theme-color" content="#4051b5">
    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/codehilite.css"/>
    
    
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&amp;display=swap" rel="stylesheet"/>
    
    
    <link rel="stylesheet" href="/css/main.css"/>
    
    <link rel="stylesheet" href="../../../css/site.css">
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>



<body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="blue">







<div class="intro">
    <div class="row no-gutters justify-content-center">
        <div class="aside col-auto">
    <img class="mb-3 sideToggle d-inline-block d-md-none" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
    <a href="/">
        <div class="logo"><img src="/img/logo-intro.png" width="185" alt="logo" srcset=""/></div>
    </a>
    <ul class="nav flex-column">
        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../documentation/"
               title="Introduction">Introduction</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../quickstart/"
               title="Quickstart">Quickstart</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../"
               title="About the docs">About the docs</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Concepts</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/rationale/"
           title="Rationale">Rationale</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/http/"
           title="HTTP">HTTP</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/serverless/"
           title="Serverless">Serverless</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/websockets/"
           title="WebSockets">WebSockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../concepts/server-sent-events/"
           title="Server-Sent Events">Server-Sent Events</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Tutorials</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/your_first_http4k_app/"
           title="Your first http4k app">Your first http4k app</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/serverless_http4k_with_aws_lambda/"
           title="Deploying an http4k app to AWS Lambda">Deploying an http4k app to AWS Lambda</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/going_native_with_graal_on_aws_lambda/"
           title="Going native with Graal on AWS Lambda">Going native with Graal on AWS Lambda</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../tutorials/tdding_http4k/"
           title="TDDing http4k">TDDing http4k</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">How-to guides</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../howto/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/server_as_a_function/"
           title="Basic: Server as a function">Basic: Server as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/client_as_a_function/"
           title="Basic: Client as a function">Basic: Client as a function</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/use_a_server_backend/"
           title="Basic: Use a Server backend">Basic: Use a Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/write_different_test_types/"
           title="Basic: Different test-types">Basic: Different test-types</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/simple_routing/"
           title="Basic: Simple routing">Basic: Simple routing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/nestable_routes/"
           title="Basic: Nestable routes">Basic: Nestable routes</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/attach_context_to_a_request/"
           title="Attach context to a request">Attach context to a request</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/configure_an_oauth_server/"
           title="Configure an OAuth Server">Configure an OAuth Server</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/create_a_custom_json_marshaller/"
           title="Create a custom JSON marshaller">Create a custom JSON marshaller</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/customise_a_server_backend/"
           title="Customise a Server backend">Customise a Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/deploy_webjars/"
           title="Deploy WebJars">Deploy WebJars</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/integrate_with_openapi/"
           title="Integrate with OpenAPI">Integrate with OpenAPI</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/leverage_graphql/"
           title="Leverage GraphQL">Leverage GraphQL</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/lookup_a_user_principal/"
           title="Lookup a User Principal">Lookup a User Principal</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/monitor_http4k/"
           title="Monitor http4k">Monitor http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/record_and_replay_http_traffic/"
           title="Record & replay HTTP traffic">Record & replay HTTP traffic</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/serve_sse/"
           title="Serve Server-Sent Events">Serve Server-Sent Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/serve_websockets/"
           title="Serve Websockets">Serve Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/structure_your_logs_with_events/"
           title="Structure your logs with Events">Structure your logs with Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/test_using_service_virtualisation/"
           title="Test using Service Virtualisation">Test using Service Virtualisation</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/typesafe_your_api_with_lenses/"
           title="Typesafe your API with lenses">Typesafe your API with lenses</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/secure_and_auth_http/"
           title="Secure and auth HTTP services">Secure and auth HTTP services</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/use_a_custom_oauth_provider/"
           title="Use a custom OAuth Provider">Use a custom OAuth Provider</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/use_a_templating_engine/"
           title="Use a templating engines">Use a templating engines</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/use_html_forms/"
           title="Use HTML forms">Use HTML forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../howto/use_multipart_forms/"
           title="Use Multipart forms">Use Multipart forms</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown active show">
            <a class="nav-link dropdown-toggle active"
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="true">Reference</a>
            <div class="dropdown-menu show">
            
            
            
    
        <a class="dropdown-item "
           href="../"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../api/"
           title="API docs">API docs</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../core/"
           title="Core">Core</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../servers/"
           title="Server backend">Server backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../serverless/"
           title="Serverless backend">Serverless backend</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../clients/"
           title="HTTP & Websocket clients">HTTP & Websocket clients</a>
    

            
            
            
    
        <a class="dropdown-item active"
           href="./"
           title="Typesafe contracts (OpenAPI3)">Typesafe contracts (OpenAPI3)</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../json/"
           title="JSON handling">JSON handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../templating/"
           title="Templating">Templating</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../multipart/"
           title="Multipart forms">Multipart forms</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../cloud_native/"
           title="Cloud Native Configuration">Cloud Native Configuration</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../cloud_events/"
           title="Cloud Events">Cloud Events</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../micrometer/"
           title="Micrometer">Micrometer</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../opentelemetry/"
           title="OpenTelemetry">OpenTelemetry</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../resilience4j/"
           title="Resilience4J">Resilience4J</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../aws/"
           title="AWS">AWS</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../oauth/"
           title="OAuth">OAuth</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../graphql/"
           title="GraphQL">GraphQL</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../jsonrpc/"
           title="JSON RPC">JSON RPC</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../xml/"
           title="XML handling">XML handling</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../yaml/"
           title="YAML handling">YAML handling</a>
    

            
            
            
    
        <a class="dropdown-item nav-link dropdown-toggle  "
            data-toggle="dropdown"
            href="#"
            role="button"
            aria-haspopup="true"
            aria-expanded="false"> Testing</a>
        <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../testing/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../approvaltests/"
           title="Approval Testing">Approval Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../chaos/"
           title="Chaos Testing">Chaos Testing</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../hamkrest/"
           title="Hamkrest">Hamkrest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../kotest/"
           title="Kotest">Kotest</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../servicevirtualisation/"
           title="Service Virtualisation">Service Virtualisation</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../strikt/"
           title="Strikt">Strikt</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../webdriver/"
           title="WebDriver">WebDriver</a>
    

            
        </div>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle "
               data-toggle="dropdown"
               href="#"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">Blog</a>
            <div class="dropdown-menu ">
            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/"
           title="Overview">Overview</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/meet_http4k/"
           title="Meet http4k">Meet http4k</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/typesafe_websockets/"
           title="Typesafe Websockets">Typesafe Websockets</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/typesafe_configuration/"
           title="Typesafe 12-factor config">Typesafe 12-factor config</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/documenting_apis_with_openapi/"
           title="Documenting http4k apps with OpenApi3">Documenting http4k apps with OpenApi3</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/retrospective_v3/"
           title="Retrospective on v3">Retrospective on v3</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/nanoservices/"
           title="Nanoservices">Nanoservices</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/toolbox/"
           title="Toolbox: Guns for show, knives for a pro">Toolbox: Guns for show, knives for a pro</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/http4k_v4/"
           title="http4k v4 - 17 platforms and counting...">http4k v4 - 17 platforms and counting...</a>
    

            
            
            
    
        <a class="dropdown-item "
           href="../../../blog/regarding_jcenter/"
           title="JCenter Shutdown">JCenter Shutdown</a>
    

            
            </div>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../changelog/"
               title="Changelog">Changelog</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../in_action/"
               title="http4k in action">http4k in action</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../performance/"
               title="Performance">Performance</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../faq/"
               title="FAQ">FAQ</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../support/"
               title="Getting support">Getting support</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../contributing/"
               title="Contribute/support http4k">Contribute/support http4k</a>
        </li>
    

        
        
        
        
    
        <li class="nav-item">
            <a class="nav-link "
               href="../../../code-of-conduct/"
               title="Code of Conduct">Code of Conduct</a>
        </li>
    

        
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/http4k/http4k">
                <img src="/img/GitHub-Mark-black.png" width="28" alt="See source on GitHub">&nbsp;&nbsp;Source Code</a>
        </li>
    </ul>
</div>
        <main class="col">
          <div class="container">
                <div class="searchBox">
                  <img class="searchBoxIcon" src="/img/search-icon.svg" width="20" alt="" srcset=""/>
                  <input id="search" type="text" />
                </div>
                <div class="content">
                    <img class="mb-3 sideToggle" src="/img/exchange-icon.svg" width="20" alt="" srcset=""/>
                    
                    
                    <h1>Typesafe contracts (OpenAPI3)</h1>
                    
                    <h3 id="installation_gradle">Installation (Gradle)<a class="headerlink" href="#installation_gradle" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">implementation</span> <span class="nl">group:</span> <span class="s2">&quot;org.http4k&quot;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s2">&quot;http4k-contract&quot;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s2">&quot;4.12.3.0&quot;</span>
<span class="n">implementation</span> <span class="nl">group:</span> <span class="s2">&quot;org.http4k&quot;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s2">&quot;http4k-format-&lt;insert json lib&gt;&quot;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s2">&quot;4.12.3.0&quot;</span>
</code></pre></div>

<h3 id="about">About<a class="headerlink" href="#about" title="Permanent link">&para;</a></h3>
<p>The <code>http4k-contract</code> module adds a much more sophisticated routing mechanism to that available in <code>http4k-core</code>. It adds the facility 
to declare server-side <code>Routes</code> in a completely typesafe way, leveraging the Lens functionality from the core. These <code>Routes</code> are combined into <code>Contracts</code>, which have the following features:</p>
<ul>
<li><strong>Auto-validating</strong> - the <code>Route</code> contract is automatically validated on each call for required-fields and type conversions, removing the requirement  for any validation code to be written by the API user. Invalid calls result in a <code>HTTP 400 (BAD_REQUEST)</code> response.     </li>
<li><strong>Self-describing:</strong> - a generated endpoint is provided which describes all of the <code>Routes</code> in that module. Implementations include <a href="http://swagger.io/">OpenApi v2 &amp; v3/Swagger</a> documentation, including generation of <a href="http://json-schema.org/">JSON schema</a>. These documents can then be used to generate HTTP client and server code in various languages using the <a href="https://openapi-generator.tech/">OpenAPI generator</a>.
 models for messages.</li>
<li><strong>Security:</strong> to secure the <code>Routes</code> against unauthorised access. Current implementations include <code>ApiKey</code>, <code>BasicAuth</code>, <code>BearerAuth</code> and <code>OAuth</code>.</li>
</ul>
<h4 id="code">Code <a href="https://github.com/http4k/http4k/blob/master/src/docs/guide/reference/contracts/example.kt"><img class="octocat"/></a><a class="headerlink" href="#code" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">package</span> <span class="nn">guide.reference.contracts</span>

<span class="c1">// for this example we&#39;re using Jackson - note that the auto method imported is an extension</span>
<span class="c1">// function that is defined on the Jackson instance</span>

<span class="k">import</span> <span class="nn">org.http4k.contract.ContractRoute</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.bind</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.contract</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.div</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.meta</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.openapi.ApiInfo</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.openapi.v3.OpenApi3</span>
<span class="k">import</span> <span class="nn">org.http4k.contract.security.ApiKeySecurity</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Body</span>
<span class="k">import</span> <span class="nn">org.http4k.core.ContentType.Companion.TEXT_PLAIN</span>
<span class="k">import</span> <span class="nn">org.http4k.core.HttpHandler</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Method.GET</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Method.POST</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Request</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Response</span>
<span class="k">import</span> <span class="nn">org.http4k.core.Status.Companion.OK</span>
<span class="k">import</span> <span class="nn">org.http4k.core.with</span>
<span class="k">import</span> <span class="nn">org.http4k.format.Jackson</span>
<span class="k">import</span> <span class="nn">org.http4k.format.Jackson.auto</span>
<span class="k">import</span> <span class="nn">org.http4k.lens.Path</span>
<span class="k">import</span> <span class="nn">org.http4k.lens.Query</span>
<span class="k">import</span> <span class="nn">org.http4k.lens.int</span>
<span class="k">import</span> <span class="nn">org.http4k.lens.string</span>
<span class="k">import</span> <span class="nn">org.http4k.routing.routes</span>

<span class="c1">// this route has a dynamic path segment</span>
<span class="kd">fun</span> <span class="nf">greetRoute</span><span class="p">():</span> <span class="n">ContractRoute</span> <span class="p">{</span>

    <span class="c1">// these lenses define the dynamic parts of the request that will be used in processing</span>
    <span class="kd">val</span> <span class="nv">ageQuery</span> <span class="o">=</span> <span class="n">Query</span><span class="p">.</span><span class="na">int</span><span class="p">().</span><span class="na">required</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
    <span class="kd">val</span> <span class="nv">stringBody</span> <span class="o">=</span> <span class="n">Body</span><span class="p">.</span><span class="na">string</span><span class="p">(</span><span class="n">TEXT_PLAIN</span><span class="p">).</span><span class="na">toLens</span><span class="p">()</span>

    <span class="c1">// this specifies the route contract, with the desired contract of path, headers, queries and body parameters.</span>
    <span class="kd">val</span> <span class="nv">spec</span> <span class="o">=</span> <span class="s">&quot;/greet&quot;</span> <span class="o">/</span> <span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="n">meta</span> <span class="p">{</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="s">&quot;tells the user hello!&quot;</span>
        <span class="n">queries</span> <span class="o">+=</span> <span class="n">ageQuery</span>
        <span class="n">receiving</span><span class="p">(</span><span class="n">stringBody</span><span class="p">)</span>
    <span class="p">}</span> <span class="n">bindContract</span> <span class="n">GET</span>

    <span class="c1">// the this function will dynamically supply a new HttpHandler for each call. The number of parameters</span>
    <span class="c1">// matches the number of dynamic sections in the path (1)</span>
    <span class="kd">fun</span> <span class="nf">greet</span><span class="p">(</span><span class="n">nameFromPath</span><span class="p">:</span> <span class="kt">String</span><span class="p">):</span> <span class="n">HttpHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">-&gt;</span>
        <span class="kd">val</span> <span class="nv">age</span> <span class="o">=</span> <span class="n">ageQuery</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="kd">val</span> <span class="nv">sentMessage</span> <span class="o">=</span> <span class="n">stringBody</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">stringBody</span> <span class="n">of</span> <span class="s">&quot;hello </span><span class="si">$</span><span class="n">nameFromPath</span><span class="s"> you are </span><span class="si">$</span><span class="n">age</span><span class="s">. You sent </span><span class="si">$</span><span class="n">sentMessage</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">spec</span> <span class="n">to</span> <span class="o">::</span><span class="n">greet</span>
<span class="p">}</span>

<span class="kd">data</span> <span class="kd">class</span> <span class="nc">NameAndMessage</span><span class="p">(</span><span class="kd">val</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kd">val</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>

<span class="c1">// this route uses auto-marshalling to convert the JSON body directly to/from a data class instance</span>
<span class="kd">fun</span> <span class="nf">echoRoute</span><span class="p">():</span> <span class="n">ContractRoute</span> <span class="p">{</span>

    <span class="c1">// the body lens here is imported as an extension function from the Jackson instance</span>
    <span class="kd">val</span> <span class="nv">body</span> <span class="o">=</span> <span class="n">Body</span><span class="p">.</span><span class="na">auto</span><span class="o">&lt;</span><span class="n">NameAndMessage</span><span class="o">&gt;</span><span class="p">().</span><span class="na">toLens</span><span class="p">()</span>

    <span class="c1">// this specifies the route contract, including examples of the input and output body objects - they will</span>
    <span class="c1">// get exploded into JSON schema in the OpenAPI docs</span>
    <span class="kd">val</span> <span class="nv">spec</span> <span class="o">=</span> <span class="s">&quot;/echo&quot;</span> <span class="n">meta</span> <span class="p">{</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="s">&quot;echoes the name and message sent to it&quot;</span>
        <span class="n">receiving</span><span class="p">(</span><span class="n">body</span> <span class="n">to</span> <span class="n">NameAndMessage</span><span class="p">(</span><span class="s">&quot;jim&quot;</span><span class="p">,</span> <span class="s">&quot;hello!&quot;</span><span class="p">))</span>
        <span class="n">returning</span><span class="p">(</span><span class="n">OK</span><span class="p">,</span> <span class="n">body</span> <span class="n">to</span> <span class="n">NameAndMessage</span><span class="p">(</span><span class="s">&quot;jim&quot;</span><span class="p">,</span> <span class="s">&quot;hello!&quot;</span><span class="p">))</span>
    <span class="p">}</span> <span class="n">bindContract</span> <span class="n">POST</span>

    <span class="c1">// note that because we don&#39;t have any dynamic parameters, we can use a HttpHandler instance instead of a function</span>
    <span class="kd">val</span> <span class="nv">echo</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="o">=</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span> <span class="o">-&gt;</span>
        <span class="kd">val</span> <span class="nv">received</span><span class="p">:</span> <span class="n">NameAndMessage</span> <span class="o">=</span> <span class="n">body</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">Response</span><span class="p">(</span><span class="n">OK</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">body</span> <span class="n">of</span> <span class="n">received</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">spec</span> <span class="n">to</span> <span class="n">echo</span>
<span class="p">}</span>

<span class="c1">// use another Lens to set up the API-key - the answer is 42!</span>
<span class="kd">val</span> <span class="nv">mySecurity</span> <span class="o">=</span> <span class="n">ApiKeySecurity</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="na">int</span><span class="p">().</span><span class="na">required</span><span class="p">(</span><span class="s">&quot;reference/api&quot;</span><span class="p">),</span> <span class="p">{</span> <span class="nb">it</span> <span class="o">==</span> <span class="m">42</span> <span class="p">})</span>

<span class="c1">// Combine the Routes into a contract and bind to a context, defining a renderer (in this example</span>
<span class="c1">// OpenApi/Swagger) and a security model (in this case an API-Key):</span>
<span class="kd">val</span> <span class="nv">contract</span> <span class="o">=</span> <span class="n">contract</span> <span class="p">{</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="n">OpenApi3</span><span class="p">(</span><span class="n">ApiInfo</span><span class="p">(</span><span class="s">&quot;My great API&quot;</span><span class="p">,</span> <span class="s">&quot;v1.0&quot;</span><span class="p">),</span> <span class="n">Jackson</span><span class="p">)</span>
    <span class="n">descriptionPath</span> <span class="o">=</span> <span class="s">&quot;/swagger.json&quot;</span>
    <span class="n">security</span> <span class="o">=</span> <span class="n">mySecurity</span>
    <span class="n">routes</span> <span class="o">+=</span> <span class="n">greetRoute</span><span class="p">()</span>
    <span class="n">routes</span> <span class="o">+=</span> <span class="n">echoRoute</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">HttpHandler</span> <span class="o">=</span> <span class="n">routes</span><span class="p">(</span><span class="s">&quot;/reference/api/v1&quot;</span> <span class="n">bind</span> <span class="n">contract</span><span class="p">)</span>

<span class="c1">// by default, the OpenAPI docs live at the root of the contract context, but we can override it..</span>
<span class="kd">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">println</span><span class="p">(</span><span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">GET</span><span class="p">,</span> <span class="s">&quot;/reference/api/v1/swagger.json&quot;</span><span class="p">)))</span>

    <span class="n">println</span><span class="p">(</span><span class="n">handler</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">POST</span><span class="p">,</span> <span class="s">&quot;/reference/api/v1/echo&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="s">&quot;reference/api&quot;</span><span class="p">,</span> <span class="s">&quot;42&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;&quot;&quot;{&quot;name&quot;:&quot;Bob&quot;,&quot;message&quot;:&quot;Hello&quot;}&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="p">}</span>
</code></pre></div>

<p>When launched, OpenApi/Swagger format documentation (including JSON schema models) can be found at the route of the module.</p>
<p>For a more extended example, see the following example apps: </p>
<ul>
<li><a href="https://github.com/http4k/http4k-by-example">TDD'd example application</a></li>
<li><a href="https://github.com/http4k/http4k-contract-todo-backend">Todo backend (typesafe contract version)</a></li>
</ul>
<h3 id="naming_of_json_schema_models">Naming of JSON Schema models<a class="headerlink" href="#naming_of_json_schema_models" title="Permanent link">&para;</a></h3>
<p>There are currently 2 options for JSON schema generation. </p>
<ol>
<li><em>OpenApi v2 &amp; v3:</em> The standard mechanism can be used with any of the supported http4k JSON modules. It generates 
anonymous JSON schema definition names that are then listed in the <code>schema</code> section of the OpenApi docs.</li>
</ol>
<div class="codehilite"><pre><span></span><code>    <span class="n">OpenApi3</span><span class="p">(</span><span class="n">ApiInfo</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="s">&quot;1.2&quot;</span><span class="p">,</span> <span class="s">&quot;module description&quot;</span><span class="p">),</span> <span class="n">Argo</span><span class="p">)</span>
</code></pre></div>

<p>... generates definitions like the following in the schema definitions:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;schemas&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;object1283926341&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;aString&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ol>
<li><em>OpenApi v3 only:</em> By including a supported Auto-JSON marshalling module on the classpath (currently only <code>http4k-format-jackson</code>), 
the names of the definitions are generated based on the Kotlin class instances provided to the Contract Route DSL. Note that 
an overloaded OpenApi function automatically provides the default Jackson instance, so we can remove it from the renderer creation:</li>
</ol>
<div class="codehilite"><pre><span></span><code>    <span class="n">OpenApi3</span><span class="p">(</span><span class="n">ApiInfo</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="s">&quot;1.2&quot;</span><span class="p">,</span> <span class="s">&quot;module description&quot;</span><span class="p">),</span> <span class="n">Jackson</span><span class="p">)</span>
</code></pre></div>

<p>... generates definitions like the following in the schema definitions:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
   <span class="nt">&quot;components&quot;</span><span class="p">:{</span>
      <span class="nt">&quot;schemas&quot;</span><span class="p">:{</span>
          <span class="nt">&quot;ArbObject&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;http://foowang&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;example&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http://foowang&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="s2">&quot;uri&quot;</span>
            <span class="p">]</span>
          <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
                    
                </div>
            </div>
        </main>
    </div>
</div>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/index-min.js"></script>

      <script src="../../../assets/javascripts/application.583bbe55.js"></script>









<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-125143867-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
  apiKey: atob(ak),
  indexName: 'http4k',
  inputSelector: '#search',
  debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
</body>
</html>